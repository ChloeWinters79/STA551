---
title: "Regression Analysis on Melbourne Housing Data"
author: "Chloé Winters"
date: "2025-10-09"
output:
  html_document:           # output document format
    toc: yes               # add table contents
    toc_float: yes         # toc_property: floating
    toc_depth: 4           # depth of TOC headings
    fig_width: 6           # global figure width
    fig_height: 4          # global figure height
    fig_caption: yes       # add figure caption
    number_sections: yes   # numbering section headings
    toc_collapsed: yes     # TOC subheading clapsing
    code_folding: hide     # folding/showing code 
    code_download: yes     # allow to download complete RMarkdown source code
    smooth_scroll: yes     # scrolling text of the document
    theme: lumen           # visual theme for HTML document only
    highlight: tango       # code syntax hightlighting styles
  pdf_document: 
    toc: yes
    toc_depth: 4
    fig_caption: yes
    number_sections: yes
  word_document:
    toc: yes
    toc_depth: '4'
---

```{css, echo = FALSE}
div#TOC li {     /* table of content  */
    list-style:upper-roman;
    background-image:none;
    background-repeat:none;
    background-position:0;
}

h1.title {    /* level 1 header of title  */
  font-size: 24px;
  font-weight: bold;
  color: DarkRed;
  text-align: center;
}

h4.author { /* Header 4 - and the author and data headers use this too  */
  font-size: 18px;
  font-weight: bold;
  font-family: "Times New Roman", Times, serif;
  color: DarkRed;
  text-align: center;
}

h4.date { /* Header 4 - and the author and data headers use this too  */
  font-size: 18px;
  font-weight: bold;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
  text-align: center;
}

h1 { /* Header 1 - and the author and data headers use this too  */
    font-size: 20px;
    font-weight: bold;
    font-family: "Times New Roman", Times, serif;
    color: darkred;
    text-align: center;
}

h2 { /* Header 2 - and the author and data headers use this too  */
    font-size: 18px;
    font-weight: bold;
    font-family: "Times New Roman", Times, serif;
    color: navy;
    text-align: left;
}

h3 { /* Header 3 - and the author and data headers use this too  */
    font-size: 16px;
    font-weight: bold;
    font-family: "Times New Roman", Times, serif;
    color: navy;
    text-align: left;
}

h4 { /* Header 4 - and the author and data headers use this too  */
    font-size: 14px;
  font-weight: bold;
    font-family: "Times New Roman", Times, serif;
    color: darkred;
    text-align: left;
}

/* Add dots after numbered headers */
.header-section-number::after {
  content: ".";
}
```




```{r setup, include=FALSE}
# code chunk specifies whether the R code, warnings, and output 
# will be included in the output files.
library(knitr)
knitr::opts_chunk$set(echo = TRUE,           # include code chunk in the output file
                      warnings = FALSE,       # sometimes, you code may produce warning messages,
                                              # you can choose to include the warning messages in
                                              # the output file. 
                      results = TRUE          # you can also decide whether to include the output
                                              # in the output file.
                      )   



library(knitr)
library(pander)
library(mlbench)
library(dplyr)
library(readr)
library(stringr)
library(purrr)
library(ggcorrplot)
library(GGally)
library(ggplot2)
library(tidyr)
library(gridExtra)
library(vcd)
library(lubridate)
library(tidyverse)
library(car)
library(caret)
library(MASS)
library(pscl)
library(ggplot2)
library(pROC)


knitr::opts_chunk$set(echo = TRUE,      
                      warnings = FALSE,   
                      messages = FALSE,  
                      results = TRUE,
                      comment = NA
                      )   

```


# Introduction

This assignment will look at housing data from Melbourne Australia and start the process of regression analysis. This will focus on both linear and logistic regression modeling based on the practical questions made in last weeks assignment. 

# Materials

## Data Set

The data set being used in this analysis consists of 34,857 observations and 25 variables which are described below. This data set was created from publicly available results posted every week from Domain.com.au and then cleaned in the assignment last week. There is a mix of numerical and categorical data in this data set. 

1. Suburb: (cat) suburb where the property is located
2. Rooms: (num) total number of rooms (including bedrooms and living areas)
3. Type: (cat) type of dwelling — house (h), unit/apartment (u), or townhouse (t)
4. Price: (num) sale price of the property in Australian dollars
5. Method: (cat) method of sale (e.g., sold, sold prior, passed in, withdrawn, etc.)
6. SellerG: (cat) real estate agency handling the sale
7. Date: (cat) sale date (in YYYY-MM-DD format)
8. Distance: (num) distance from the property to the Melbourne Central Business District (CBD) in kilometers
9. Postcode: (cat) postal code of the property location
10. Bedroom2: (num) number of bedrooms (from an alternate data source)
11. Bathroom: (num) number of bathrooms
12. Car: (num) number of car parking or garage spaces
13. Landsize: (num) land area of the property in square meters
14. CouncilArea: (cat) name of the local governing council for the property
15. Lattitude: (num) latitude coordinate of the property
16. Longtitude: (num) longitude coordinate of the property
17. Regionname: (cat) broader region classification of the suburb
18. Propertycount: (num) total number of properties within the suburb
19. SaleYear: (num) numeric year of sale extracted from the Date variable
20. SaleMonth: (cat) month of sale extracted from the Date variable (abbreviated form)
21. LogPrice: (num) log-transformed sale price used to reduce skewness in Price
22. CouncilAreaGrouped: (cat) grouped version of council areas to consolidate smaller categories
23. SuburbGrouped: (cat) grouped version of suburbs for improved model stability
24. SellerBinary: (num) binary variable for seller type (1 = large/major agency, 0 = small/local agency)
25. SoldBinary: (num) binary indicator of sale status (1 = sold by any method, 0 = not sold)

```{r}
url ="https://chloewinters79.github.io/STA551/Data/MelbourneHousing_Cleaned.csv"
house_cleaned = read.csv(url, header = TRUE)
```

# Methodolgy & Analysis

## Linear Model

To start the linear regression the assignment asks for a model to be created using practical variables. Since we are analyzing our practical question regarding price, which we did take the log of in the last assignment, we decided to make a model with the following variables, Rooms, Bathroom, Car, and Distance. From the summary output, all the variables have a p-value less than 0.05 and are statistically significant, and the same applies to the overall model. 

```{r}
# Practical Model
lm_practical <- lm(LogPrice ~ Rooms + Bathroom + Car + Distance, data = house_cleaned)
summary(lm_practical)
```
For the second model the assignment calls for additional models to be added to the initial practical model to make a more expanded model. In addition to the variables in the first practical model this model includes, SellerBinary, Regionname, and Propertycount. Looking at the summary output for the model there is one variable that does not have a p-value less than 0.05, which is RegionnameNorthern Victoria. However all the other subsets of the Regionname variable have a p-value less than 0.05 indicating statistical significance. The model also has a p-value less than 0.05 and is statistically significant. 

```{r}
# Extended Model
lm_extended <- lm(LogPrice ~ Rooms + Bathroom + Car + Distance + SellerBinary + Regionname + Propertycount, data = house_cleaned)
summary(lm_extended)
```

Finally, the assignment asks for a variable selection method to identify the optimal final model. For this data set, stepwise direction will be used to determine the optimal model. The final model turns out to be a replica of the extended model, none of the variables were removed and no new variables were added. 

```{r}

lm_final <- stepAIC(lm_extended, direction = "both", trace = FALSE)
summary(lm_final)

# View final model formula
formula(lm_final)
```

When looking at the model comparisons we are looking for the highest adjusted R squared value and the lowest AIC. In this case this it both the extended and stepwise model, which makes sense considering they are the same model. Which means that final/extended model is the better model compared to the practical model. 

```{r}
model_comparison <- data.frame(
  Model = c("Practical", "Extended", "Final (Stepwise)"),
  Adj_R2 = c(summary(lm_practical)$adj.r.squared,
             summary(lm_extended)$adj.r.squared,
             summary(lm_final)$adj.r.squared),
  AIC = c(AIC(lm_practical),
          AIC(lm_extended),
          AIC(lm_final))
)
model_comparison

```

Now that we are operating with the final model there needs to be some diagnostics and interpretation of outputs for our final mode. First starting with the diagnostic plots, while some of the plots are quite crowded considering the sheer number of observations, overall they all look appropriate. There is no clear curvature or outliers and all the residuals look roughly normal. For all the VIF values they are all less than 5 so we do not have any multicollinearity issues to worry about.

```{r}

par(mfrow = c(2, 2))
plot(lm_final)


library(car)
vif(lm_final)


exp_coef <- exp(coef(lm_final)) - 1
round(exp_coef, 3)


```

## Logistic Model

Now moving onto the logistic modeling, this will look at the models for our second practical question which looks at whether or not a house sold. Starting again with the practical model it contains the following variables, LogPrice, Rooms, and Distance. Looking at the output summary, the variable LogPrice has a p-value larger than 0.05 and would not be considered statistically significant, while the variables Rooms and Distance do have p-values smaller than 0.05 and are statistically significant.

```{r}
# Practical Model
logit_practical <- glm(SoldBinary ~ LogPrice + Rooms + Distance,
                       data = house_cleaned, family = binomial)
summary(logit_practical)
```
Moving onto the the extended model the variables from the practical model are still being used, with the addition of SellerBinary, Regionname, Car and Bathroom. In this model three of the different Regionname sub variables have a p-value greater than 0.05 and are not statistically significant. Additionally, the variable SellerBinary has a p-value greater than 0.05 and is not statistically significant. All other variables have a p-value smaller than 0.05 and are statistically significant. 


```{r}
## Extended Model
logit_extended <- glm(SoldBinary ~ LogPrice + Rooms + Distance + SellerBinary +
                        Regionname + Car + Bathroom, 
                      data = house_cleaned, family = binomial)
summary(logit_extended)

```

Finally, the assignment asks for a variable selection method to identify the optimal final model. For this data set, stepwise analysis will be used to determine the optimal model. From the output we know the formula being used for the final model has the variables LogPrice, Rooms, Distance,  Regionname, Car, and Bathroom. Similar to the extended model, some of the sub categories of the Regionname variable have a p-value larger than 0.05 and are not statistically significant, however the rest of the variables do have a p-value less than 0.05 and are statistically significant. 

```{r}

# Final Model

logit_final <- stepAIC(logit_extended, direction = "both", trace = FALSE)
summary(logit_final)

# View final model formula
formula(logit_final)

```

When doing a model comparison we are looking for the smallest AIC and largest Pseudo_R2. In this case the extended and final models are not identical but are extremely close, with the final model being slightly better than the extended model. The final model is also better because it is the simpler model, which when two models are very similar in their comparison we ideally want to use the simpler model because it would not make sense to use a more complex model to get similar results to a simple model. This means our final model is the most optimal model for us to use for our practical question.

```{r}
# Model Comparison 

model_comparison_logit <- data.frame(
  Model = c("Practical", "Extended", "Final (Stepwise)"),
  AIC = c(AIC(logit_practical),
          AIC(logit_extended),
          AIC(logit_final)),
  Pseudo_R2 = c(pR2(logit_practical)["McFadden"],
                pR2(logit_extended)["McFadden"],
                pR2(logit_final)["McFadden"])
)
model_comparison_logit

```

Now that the final model has been determined, model diagnostics need to be performed on the model. This includes determining the area under the curve or the ROC AUC and the model accuracy. The ROC AUC is 0.656q, which is not the strongest but is still a fair value. Our accuracy is 0.8963424, which is great because typically anything above 0.7 threshold is acceptable. 

```{r}

pred_probs <- predict(logit_final, type = "response")


pred_class <- ifelse(pred_probs > 0.5, 1, 0)


accuracy <- mean(pred_class == logit_final$y)  # use model's response
accuracy


roc_curve <- roc(logit_final$y, pred_probs)
plot(roc_curve, main = "ROC Curve for Final Logistic Model")
auc(roc_curve)


```

```{r}
odds_ratios <- exp(coef(logit_final))
round(odds_ratios, 3)

# Comment:
# An odds ratio > 1 indicates an increased likelihood of sale for a one-unit increase in that variable.
# For example, an odds ratio of 1.25 for Rooms means each additional room increases
# the odds of sale by approximately 25%, holding other variables constant.

```


# Results & Conclusion

This assignment allowed us to build multiple models for our two practical questions and determine the best model to use for each of the practical questions. Once the final models were determined they under went the model diagnostic process which was successful for both models with no concerning findings or violations of assumptions appearing. These models can now help up answer the practical questions of predicting the price a house will sell for and whether or not the house will actually sell. Being able to answer these questions will be very helpful for those in the real estate market. The next assignment will cover cross validation and predictive linear and logistic regression modeling and allow us to delve even further into our analysis and make a more well rounded conclusion of the overall analysis being conducted on this data. 


